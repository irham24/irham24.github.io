
<!DOCTYPE html>
<html>
<head>
	
	<!-- Primary Meta Tags -->
	<title>IrhaMap: Let's back to the past with GIS</title>
	<meta name="title" content="Interactive and Responsive Historical Map | IrhaMap">
	<meta name="description" content="Let's back to the past with GIS">

	<!-- Open Graph / Facebook -->
	<meta property="og:type" content="website">
	<meta property="og:url" content="https://irham24.github.io/maps/">
	<meta property="og:title" content="Interactive and Responsive Historical Map | IrhaMap">
	<meta property="og:description" content="Back to the past with GIS">
	<meta property="og:image" content="https://i.ibb.co/rGKKXwC/Peta-Tua-Cover-low.jpg">

	<!-- Twitter -->
	<meta property="twitter:card" content="summary_large_image">
	<meta property="twitter:url" content="https://irham24.github.io/maps/">
	<meta property="twitter:title" content="Interactive and Responsive Historical Map | IrhaMap">
	<meta property="twitter:description" content="Back to the past with GIS">
	<meta property="twitter:image" content="https://i.ibb.co/rGKKXwC/Peta-Tua-Cover-low.jpg">
	
	<meta property="og:site_name" content="IrhaMap: Let's back to the past with GIS">
	

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="./assets/img/favicon.ico"/>
	
	<!-- Leaflet -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
	
	<!-- Leaflet side by side -->
	<!-- <link href="https://cdn.jsdelivr.net/npm/leaflet-side-by-side@2.2.0/layout.min.css" rel="stylesheet"> -->
	<script src="./assets/js/leaflet-side-by-side.js"></script>
	
	<!-- Font Awesome -->
	<!-- <script src="https://kit.fontawesome.com/f6d734016a.js"></script> -->
	<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/css/all.min.css" rel="stylesheet">
	<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.1/js/all.min.js"></script> -->
	<!-- JQuery -->
	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
	
	<!-- Easy Button -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
	<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>
	
	<!-- Share js -->
	<script src="https://cdn.jsdelivr.net/npm/sharer.js@latest/sharer.min.js"></script>
	<style>
		html, body {
			height: 100%;
			width: 100%;
			margin: 0;
			overflow-y: hidden;
			position: fixed;
		}
		#map {
			height: 100%;
			width: 100%;
			z-index: 10;
		}
		
		.leaflet-control-layers-header {
			font-size: larger;
			font-weight: bold;
			display: block;
			position: relative;
		}
		
				
		.sidenav {
		  height: 100%;
		  width: 25%;
		  position: fixed;
		  z-index: 9999;
		  top: 0;
		  left: -25%;
		  background-color: #fff;
		  overflow-x: hidden;
		  transition: 0.5s;
		  padding-bottom: 1%;
		}
		
		.btnSidenav {
		  height: 30px;
		  width: 10px;
		  position: fixed;
		  z-index: 9999;
		  top: 8px;
		  left: 0%;
		  background-color: #fff;
		  transition: 0.5s;
		  padding-top: 15px;
		  padding-left: 10px;
		  padding-right: 5px;
		  color: #818181;
		  cursor: pointer;
		}
		
		.btnIcon :hover{
		  color: #111;
		}
		
		.bottom-drawer{
		  height:100%;
		  width:100%;
		  top: 100vh - 40px;
		  z-index: 9999;
		  position: absolute;
		  border-top-left-radius: 12px;
		  border-top-right-radius: 12px;
		  background-color: #fff;
		  transition: 0.2s !important;
		}
		
		.drawer-content {
			height: auto;
			overflow: auto;
		}
		
		
		/* Tree View */		
		/* Remove default bullets */
		ul, #myUL {
		  list-style-type: none;
		  padding-left : 10px;
		  margin-top: 5px;
		  margin-bottom: 5px;
		}

		/* Remove margins and padding from the parent ul */
		#myUL {
		  margin: 0;
		  padding: 0;
		}

		/* Style the caret/arrow */
		.caret {
		  cursor: pointer;
		  user-select: none; /* Prevent text selection */
		}

		/* Create the caret/arrow with a unicode, and style it */
		.caret::before {
		  content: "\25B6";
		  color: black;
		  display: inline-block;
		  margin-right: 6px;
		}

		/* Rotate the caret/arrow icon when clicked on (using JavaScript) */
		.caret-down::before {
		  transform: rotate(90deg);
		}

		/* Hide the nested list */
		.nested {
		  display: none;
		}

		/* Show the nested list when the user clicks on the caret/arrow (with JavaScript) */
		.active {
		  display: block;
		}
		
		/* Tab */
		.tab {
		  overflow: hidden;
		  border: 1px solid #ccc;
		  background-color: #f1f1f1;
		}

		/* Style the buttons inside the tab */
		.tab button {
		  background-color: inherit;
		  float: left;
		  border: none;
		  outline: none;
		  cursor: pointer;
		  padding: 5px 2%;
		  transition: 0.3s;
		  font-size: 17px;
		}

		/* Change background color of buttons on hover */
		.tab button:hover {
		  background-color: #ddd;
		}

		/* Create an active/current tablink class */
		.tab button.active {
		  background-color: #ccc;
		}

		/* Style the tab content */
		.tabcontent {
		  display: none;
		  padding: 6px 12px;
		  border: 1px solid #ccc;
		  border: none;
		  overflow: auto;
		  height: 93%;
		}
		
		/* Share Button */
		/* Add a hover effect if you want */
		.sharebtn {
		  border: none;
		  outline: none;
		  cursor: pointer;
		  text-align: center;
		  padding: 2% 4%;
		  width: 40px;
		  font-size: 12px;
		}
		.sharebtn:hover {
		  opacity: 0.7;
		}
		
		.copybtn:hover{
			opacity:0.7;
			-webkit-filter: brightness(70%);
			-moz-filter: brightness(70%);
			-o-filter: brightness(70%);
			-ms-filter: brightness(70%);
			filter: brightness(70%);
		}
	</style>
	
</head>
<body>

<div id='map'></div>
<section class="sidenav-sec"></section>
<section class="bottom-drawer"></section>
<script>
	// STARTING
	document.body.style.height = window.innerHeight + 'px';
	document.getElementsByTagName("html")[0].style.height = window.innerHeight + 'px';
	$('#bottom-sheet').css("height",window.innerHeight + 'px');
	var btmDrawerHeight = window.innerHeight * 3 /100;
	var btmDrawerHalfHeight = window.innerHeight * 40 /100;
	var embedWidth = 300;
	var embedHeight = 200;
	var embed = '';
	
	// Checking the used device
	var mobileCheck = (window.innerWidth < window.innerHeight);
	var infoBox = mobileCheck ? '.drawer-content' : '.sidenav-content'
	var otherInfoBox = mobileCheck ? '.sidenav-sec' : '.bottom-drawer'	

	//Drawer
	$(document).ready(function() {
		var click = false
		var pos = 0
		//if (mobileCheck){
			$('#bottom-sheet').mousedown(function(e) {
				e.preventDefault();
				click = true
			})
			$('#bottom-sheet').on('touchstart', function(e) {
				e.preventDefault();
				click = true
			})
			$(window).mousemove(function(e) {
				mouseMove(e)
			})
			$(window).mouseup(function(e) {
				mouseUp(e)
			})
			$(window).on('touchmove', function(e) {
				mouseMove(e.touches[0])
			})
			$(window).on('touchend', function(e) {
				mouseUp(e.changedTouches[0])
				// console.log(e.changedTouches[0].pageY)
			})
		//}
		function mouseMove(e) {
			if(click) {
				//console.log(e.pageX, e.pageY)
				$('.bottom-drawer').css({height: innerHeight + 'px'});
				if(e.pageY > innerHeight - btmDrawerHeight) {
					$('.bottom-drawer').css({
						top: innerHeight - btmDrawerHeight + 'px'
					})
					// click = false
				}else if(e.pageY < 0){
					$('.bottom-drawer').css({
						top: '0px'
					})
				}else{
					$('.bottom-drawer').css({
						top: e.pageY + 'px'
					})
				}
			}
		}
		function mouseUp(e) {
			if(click) {
				//deket bawah
				//pos 0 (dibawah), pos 1 (diatas), pos 2 (hampir tengah)
				if(e.pageY > (innerHeight * 25/100) && pos == 1){ // kalo dari atas tapi scroll kebawah lebih dr 10%
					pos = 0
				} else if((e.pageY < innerHeight - (innerHeight * 5/100) && pos == 0) || // supaya ke tengah
				   (e.pageY > (innerHeight * 5/100) && pos == 1)){
					pos = 2
				} else if(e.pageY < (innerHeight - btmDrawerHalfHeight) - (innerHeight * 2.5/100) && pos == 2){
					pos = 1
				} else if(e.pageY > (innerHeight - btmDrawerHalfHeight) + (innerHeight * 2.5/100) && pos == 2){
					pos = 0
				}
				botDrawerByPos(pos);
				updateURL();
			}
			click = false;
		}
	})
	// bottom-drawer func by pos id
	function botDrawerByPos(pos){
		if(pos==0){				$('.bottom-drawer').css({top: innerHeight - btmDrawerHeight + 'px'});
			} else if (pos==1){	$('.bottom-drawer').css({top: '0px'});
								$('.bottom-drawer').css({height: innerHeight + 'px'});
								$('.drawer-content').css({height: innerHeight - $('#bottom-sheet')[0].offsetHeight - 50 + 'px'});
			} else {			$('.bottom-drawer').css({top: innerHeight - btmDrawerHalfHeight + 'px'});
								$('.bottom-drawer').css({height: btmDrawerHalfHeight + 'px'});
								$('.drawer-content').css({height: btmDrawerHalfHeight - $('#bottom-sheet')[0].offsetHeight - 50 + 'px'});	
		}
		Array.from(document.getElementsByClassName("tabcontent")).forEach(
			function(element, index, array) {
				element.style.height = $('.drawer-content')[0].style.height;
			}
		);
	}		

	// Sidenav
	function btnNav(){
	//console.log("start");
		if(document.getElementById("btnSidenav").style.left < "25%"){
			document.getElementById("mySidenav").style.left = "0";
			document.getElementById("btnSidenav").style.left = "25%";
			document.getElementById("btnSidenav").style.backgroundColor = "#f1f1f1";
			document.getElementById("btnIcon").className = "fas fa-caret-left";
		} else {
		    document.getElementById("mySidenav").style.left = "-25%";
		    document.getElementById("btnSidenav").style.left = "0";
			document.getElementById("btnSidenav").style.backgroundColor = "#fff";
			document.getElementById("btnIcon").className = "fas fa-caret-right";
		}
		updateURL();
	}


	// get Param from URLs
	var params = {};
	var i = 0;
	window.location.href.replace(/[?@&]+([^&]*)/gi, function(m, item){
		//params[key] = value;
		if (i==0){
			let item_arr = item.split(",");
			params['lat'] = item_arr[0];
			params['lng'] = item_arr[1];
			params['zoom'] = item_arr[2].replace("z", "");
			//console.log(item_arr);
		} else {
			item_arr = item.split("=");
			if (item_arr[0]=="marked"){
				let value = item_arr[1].split("@");
				params['marked_content'] = value[0];
				if (value.length > 1){
					let coord = value[1].split(",");
					params['marked_lat'] = coord[0];
					params['marked_lng'] = coord[1];
				} else {
					params['marked_lat'] = params['lat'];
					params['marked_lng'] = params['lng'];
				}
			} else {
				params[item_arr[0]] = item_arr[1];
			}
		}
		i+=1;
	});
	//console.log(params);


	// Basemap map
	
	// Esri Basemap
	//L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
	//	attribution: 'Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012'
	//}).addTo(map);
	
	// OSM Basemap
	var osmLayer = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap<\/a> contributors'
    });
	// Google Streets Basemap
	var googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3'],
	attribution: 'Basemap &copy; Google'
	});
	// Google Satelite Basemap
	var googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3'],
	attribution: 'Basemap &copy; Google'
	});
	// Google Hybrid Basemap
	var googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3'],
	attribution: 'Basemap &copy; Google'
	});
	var basemap_default = osmLayer
	
	// Data
	
	// Old Atlas
	var oldTilesAtlas = L.tileLayer('https://maps.georeferencer.com/georeferences/4d239dd5-e40b-5b47-802a-902f6010704c/2019-11-17T19:53:34.045791Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "(1) Typus Orbis Terrarum. by Ortelius, Abraham, 1527-1598; Tiles <a href='https://davidrumsey.georeferencer.com/maps/4e930a7e-3839-5263-8959-502ee675442a/'>davidrumsey.com</a>.",
	id:"4d239dd5-e40b-5b47-802a-902f6010704c"
	});
	
	// Old Atlas
	var oldTilesAtlas2 = L.tileLayer('https://maps.georeferencer.com/georeferences/11a84caa-a653-5b29-9728-93555bebd62f/2020-06-25T21:29:22.834301Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "128-129. Indonesia. The World Atlas by USSR (Union of Soviet Socialist Republics); 1967; Tiles <a href='https://davidrumsey.georeferencer.com/maps/a016c171-dd3f-55fa-a5a7-9bb6f0b79a3d/'>davidrumsey.com</a>.",
	id:"a016c171-dd3f-55fa-a5a7-9bb6f0b79a3d"
	});
	
	// Old Atlas
	var oldTilesAtlas3 = L.tileLayer('https://maps.georeferencer.com/georeferences/d39f475a-61e5-585d-a2cd-744c341ddcef/2017-03-22T21:35:39.075608Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "Composite: A Chart of the World upon Mercator's projection exhibiting all the new discoveries. Sheets 1-8. by Arrowsmith, Aaron; 1808; Tiles <a href='https://davidrumsey.georeferencer.com/maps/2be32158-1dc7-5071-94cf-6c9912f5865d/'>davidrumsey.com</a>.",
	id:"2be32158-1dc7-5071-94cf-6c9912f5865d"
	});
	
	// Old Atlas
	var oldTilesAtlas4 = L.tileLayer('http://maps.nypl.org/warper/maps/tile/8870/{z}/{x}/{y}.png',{
    maxZoom: 20,
	attribution: "Orbis terrae compendiosa descriptio : quam ex magna universali Gerardi Mercatoris Domino Richardo Gartho, geographie ac ceterarum bonarum artium amatori ac fautori summo, in veteris amicitie ac familiaritatis memoriam Rumoldus Mercator fieri curabat A0. M.D. LXXXVII. by Mercator, Gerhard; 1637?; Tiles <a href='https://digitalcollections.nypl.org/items/510d47e2-0b65-a3d9-e040-e00a18064a99'>New York Public Library</a>.",
	id:"510d47e2-0b65-a3d9-e040-e00a18064a99"
	});
	
	// Old Atlas
	var oldTilesAsia = L.tileLayer('https://maps.georeferencer.com/georeferences/3ff3a0c0-c845-5639-916d-5b306ddde711/2020-07-22T11:39:34.827989Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "A New Map of East India. by Speed, John, 1542-1629; 1676; Tiles <a href='https://davidrumsey.georeferencer.com/maps/a016c171-dd3f-55fa-a5a7-9bb6f0b79a3d/'>davidrumsey.com</a>.",
	id:"3ff3a0c0-c845-5639-916d-5b306ddde711"
	});
	
	// Old Atlas
	var oldTilesAsia2 = L.tileLayer('https://maps.georeferencer.com/georeferences/7ad0719c-51b7-5e78-bffe-834025435c15/2020-01-27T05:07:24.246354Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "Indiae Orientalis, Insularumque Adiacientium Typus. Cum Privilegio. by Ortelius, Abraham, 1527-1598; 1570; Tiles <a href='https://davidrumsey.georeferencer.com/maps/c015bf3c-c8c7-5ee0-8331-3ed7f4baf716/'>davidrumsey.com</a>.",
	id:"7ad0719c-51b7-5e78-bffe-834025435c15",
	story:"Indiae Orientalis Insularumque Adiacientium Typus merupakan peta “tonggak sejarah” Asia Tenggara termasuk Kepulauan Indonesia. Peta ini menampilkan perpaduan terbaik ilmu kartografi dan informasi tentang wilayah Asia Tenggara dan Kepulauan Indonesia pada tujuh puluh tahun pertama abad ke-16. Peta ini dimuat dalam sebuah atlas geografi modern yang berjudul Theatrum Orbis Terrarum yang disusun oleh <a href='https://en.wikipedia.org/wiki/Abraham_Ortelius'>Abraham Ortelius</a> (1527 – 1598). Atlas ini dibuat dalam lembar-lembar tepisah yang memuat 25 lembar teks dan 53 buah peta cetakan lempeng tembaga. Deskripsi asli menggunakan tulisan latin yang kemudian diterjemahkan ke dalam berbagai bahasa Eropa. Sejak edisi tahun 1608 dipublikasikan dalam bahasa Belanda, Jerman, Perancis, Spanyol, Inggris, dan Itali.<br><br>Peta ini menggambarkan kepulauan Indonesia yang terakhir dibuat sebelum kedatangan Belanda ke Nusantara. Penggambarannya sangat luas, dari wilayah bagian barat India yang dikuasai Portugis, menyambung ke Cina, Jepang, Asia Tenggara, termasuk Kepulauan Indonesia sampai Papua, bahkan sampai pantai Barat laut Amerika. Pulau- pulau di Indonesia masih terlihat dalam bentuk yang belum sempurna meskipun susunan atau tata letaknya sudah terlihat baik. Di dalam peta ini Pulau Jawa disebutkan sebagai Iava Maior.<br><br>Di sisi lain tampak pulau-pulau penghasil rempah-rempah seperti Ternate, Tidore, dan sekitarnya di bagian selatan. Machian dan Bacam digambarkan dengan letak yang tepat sampai sebelah barat Pulau Halmahera (Gigolo). Digambarkan pula Pulau Buru, Pulau Ambon yang sekarang disebut Seram, serta bagian kepala burung Pulau Papua digambarkan dalam tiga pulau kecil. Pulau Gebe, di mana Perancis pertama kali mendapatkan cengkeh dan Pala pada abad ke-18 terlihat tepat di garis equator di antara Pulau Halmahera dan Papua. Penggambaran peta ini dipadu dengan gambar-gambar serta penulisan teks yang unik, sehingga menjadikan peta ini sangat menarik.<br><br>Peta ini dikoleksi oleh Museum Nasional sebagai salah satu dari koleksi Geografi Museum Nasional.<br>Sumber: <a href='https://kebudayaan.kemdikbud.go.id/munas/indiae-orientalis-insularumque-adiacntium-typus/'>kemendikbud.go.id</a>",
	img:"https://images.iiifhosting.com/iiif/aff1945b7fa71cbcb096dbf31fb8a6e0f54d8349ab48138a589c3b8a3f7d8179/"
	});
	
	// Old Atlas
	var oldTilesAsia3 = L.tileLayer('https://geo.leventhalmap.org/maps/tile/1379/{z}/{x}/{y}.png',{
    maxZoom: 20,
	attribution: "Nova et exacta Asiae geographica descriptio by Allard, Huych, 1625-1691; 1660; Tiles <a href='https://collections.leventhalmap.org/search/commonwealth:st74cw78w'>Norman B. Leventhal Map Center Collection</a>.",
	id:"st74cw78w"
	});
	
	// Old Atlas
	var oldTilesAsia4 = L.tileLayer('https://geo.leventhalmap.org/maps/tile/6923/{z}/{x}/{y}.png',{
    maxZoom: 20,
	attribution: "To the Right Honourable William, Lord Cowper, Lord High Chancellor of Great Britain, this map of Asia : according to ye newest and most exact observations is most humbly dedicated. by Moll, Herman, d. 1732; 1710–1719; Tiles <a href='https://collections.leventhalmap.org/search/commonwealth:cj82ks63j'>Norman B. Leventhal Map Center Collection</a>.",
	id:"cj82ks63j",
	story:"Peta ini dibuat oleh <a href='https://en.wikipedia.org/wiki/Herman_Moll'>Herman Moll</a> (1654? - 1732) kartografer paling terkenal pada awal abad 18 di Inggris. Peta ini termasuk salah satu kumpulan peta yang dibuat Moll dan di publikasikan dengan judul The World Described. Moll menggunakan peta-peta tersebut untuk mempublikasikan dan mendukung kebijakan Inggris dan klaim daerah terhadap dunia.<a href='https://en.wikipedia.org/wiki/Herman_Moll#cite_note-7'>[1]</a><a href='https://en.wikipedia.org/wiki/Herman_Moll#cite_note-8'>[2]</a> Peta ini didedikasikan kepada <a href='https://en.wikipedia.org/wiki/William_Cowper,_1st_Earl_Cowper'>William Cowper</a>, 1st Earl Cowper yaitu orang pertama yang dilantik sebagai Lord High Chancellor, jabatan senior dalam pemerintahan Britania Raya.<br>Note : Map of the Middle East and Asia including the East Indies. It features characteristic misconceptions of early 18th century cartography such as New Guinea as a peninsula of the southern continent and Iapon or Niphon [i.e. Japan] having a huge northern island called Land of Iesso [presumably the islands of Hokkaido and Sakhalin]. Prime meridians: Ferro and London. Relief shown pictorially. Dedicated to Lord Cowper, High Chancellor of Great Britain from 1714-1718. Block of text at far right lower side of map indicating that two Jesuit explorers, Paul Clain and Le Gibien, had reported 87 islands found east or south-east of the Philippines but this was not yet confirmed by other explorers. Insets: Hellespont, or ye Straits of Constantinople -- The Gulf of Smirna -- Bombay and Sallset Isl. -- Hugley R. from Buffalow Point to Hugly Towne -- The Ice Sea -- Part of Chusan I. -- [Amoy Island]. Appears in Moll's The world described, [1709-1736], plate 4.",
	img:"https://collections.leventhalmap.org/search/commonwealth:cj82ks63j#image"
	});
	
	// Old Atlas
	var oldTilesAsia5 = L.tileLayer('http://maps.nypl.org/warper/maps/tile/30220/{z}/{x}/{y}.png',{
    maxZoom: 20,
	attribution: "Insulae Moluccæ, graven by Beckit, Robert; 1598; Tiles <a href='https://digitalcollections.nypl.org/items/b6335663-9709-ce98-e040-e00a18064c2c'>New York Public Library</a>.",
	id:"b6335663-9709-ce98-e040-e00a18064c2c"
	});
	
	// Old Atlas
	var oldTilesIndonesia = L.tileLayer('https://maps.georeferencer.com/georeferences/d711d237-f857-5d7c-a269-d71e2cab8eff/2019-06-14T11:33:58.207353Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "Kaart van den Nederlandsch-Indischen Archipel by Topografische Inrichting Batavia; 1920; Tiles <a href='https://leiden.georeferencer.com/maps/10310bda-a8b9-531a-90e6-506f50caa994/'>Universiteit Leiden</a>.",
	id:"10310bda-a8b9-531a-90e6-506f50caa994"
	});
	
	// Old Atlas
	var oldTilesIndonesia2 = L.tileLayer('https://maps.georeferencer.com/georeferences/d436717e-384f-5e8c-a2b4-f55a1cb296ec/2019-06-07T13:07:57.042769Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "Indonesië : voorlopige staatkundige ordening, bijgewerkt tot 1 october 1949; 1949; Tiles <a href='https://leiden.georeferencer.com/maps/c8d7dc1b-1dcb-5f14-a417-a5d26cbccff8/'>Universiteit Leiden</a>.",
	id:"c8d7dc1b-1dcb-5f14-a417-a5d26cbccff8",
	story:"Peta ini menggambarkan pembagian sementara negara bagian dan daerah otonom dari <a href='https://id.wikipedia.org/wiki/Republik_Indonesia_Serikat'>Republik Indonesia Serikat(RIS)</a> pada tanggal 1 Oktober 1949 dalam <a href='https://id.wikipedia.org/wiki/Konferensi_Meja_Bundar'>Konferensi Meja Bundar (KMB)</a>. pertemuan ini dilaksanakan di Den Haag Belanda, dari tanggal 2 Agustus hingga 2 November 1949. Konferensi ini dilakukan untuk mendapatkan kedaulatan Indonesia setelah menyerahnya jepang pada tanggal 15 Agustus 1945 dan pembacaan Proklamasi Kemerdekaan Indonesia pada tanggal 17 Agustus 1945.",
	img:"https://images.iiifhosting.com/iiif/e93fb7990e31feb9d24799e65617c2998d22f2333dd6da390449e5ee4700fcff/"
	});
	
	// Old Atlas
	var oldTilesIndonesia3 = L.tileLayer('https://maps.georeferencer.com/georeferences/21cc8c23-9452-592d-9944-44a5cffd5eb7/2017-11-11T17:35:43.303919Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "Carte des Isles de la Sonde, et des Isles Moluques by Bonne, R.; 1780; Tiles <a href='https://davidrumsey.georeferencer.com/maps/94a056e5-066f-5188-b4f9-00a317c3f953/'>davidrumsey.com</a>.",
	id:"21cc8c23-9452-592d-9944-44a5cffd5eb7"
	});
	
	// Google Hybrid Basemap
	var oldTilesJava2 = L.tileLayer('https://maps.georeferencer.com/georeferences/f4d811bd-84f3-5fb8-9726-58ad2b65690d/2020-06-08T13:04:42.118227Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "Reduzirte Karte vom Sunda- Oder Borneo-Meere und den Strassen zur ... by dem .. Admiral Krusenstern [...] gewidmet von H. Berghaus; 1835; Tiles <a href='https://uu.georeferencer.com/maps/8c5d0f61-9f1d-58f8-9312-8582489be2bb/'>Utrecht University</a>.",
	id:"8c5d0f61-9f1d-58f8-9312-8582489be2bb"
	});
	
	// Google Hybrid Basemap
	var oldTiles = L.tileLayer('https://maps.georeferencer.com/georeferences/1bc7a3d8-866c-585b-84ba-899a91efabaa/2020-02-11T09:13:45.592512Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "Kaart van Nederlands Oostindische bezittingen on Ackersdijck Collection; 1843; Tiles <a href='https://uu.georeferencer.com/maps/5c7f3cbb-51e3-59ba-ba8f-1f9d685ee0ae/'>Utrecht University</a>.",
	id:"5c7f3cbb-51e3-59ba-ba8f-1f9d685ee0ae"
	});
	
	// Google Hybrid Basemap
	var oldTiles2 = L.tileLayer('https://maps.georeferencer.com/georeferences/2d9a279c-f8ea-5904-a92c-f6b4c6433c23/2019-06-14T08:43:58.218505Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "Bevolkingskaart van Nederlandsch Oost-Indië / J. Kuyper on KITLV Heritage Collection; 1890; Tiles <a href='https://leiden.georeferencer.com/maps/7ac9d994-87bc-5b7e-a31c-163dcb1e7486/'>Universiteit Leiden</a>.",
	id:"7ac9d994-87bc-5b7e-a31c-163dcb1e7486"
	});
	
	// Google Hybrid Basemap
	var oldTiles3 = L.tileLayer('http://maps.georeferencer.com/georeferences/38b6b69b-b527-564c-a70a-491381428e2e/2018-01-15T10:30:24.598882Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "La presqu'isle de l'Indie au dela du Gange, avec l'archipel des Indes by Bonne, Rigobert; 1787; Tiles <a href='http://cuni.georeferencer.com/maps/7030ed26-ef46-5851-85d2-02bc7777d299/'>staremapy.cz</a>.",
	id:"7030ed26-ef46-5851-85d2-02bc7777d299"
	});
	
	// Google Hybrid Basemap
	var oldTiles4 = L.tileLayer('http://maps.georeferencer.com/georeferences/b575c778-daec-5341-8c15-b2bce7c8561a/2018-01-15T10:30:24.598882Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "CARTE DES INDES ORIENTALES by Mayer, Tobias; 1748; Tiles <a href='http://cuni.georeferencer.com/maps/755be85c-97b4-5f04-b316-0e55347043f2/'>staremapy.cz</a>.",
	id:"b575c778-daec-5341-8c15-b2bce7c8561a"
	});
	
	// Google Hybrid Basemap
	var oldTilesJava = L.tileLayer('https://maps.georeferencer.com/georeferences/253cc15b-bf50-5f45-a15f-a22f42ea3e1d/2019-06-06T09:54:03.402984Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "Nouvelle Carte de l'isle de Java by de Wed. S. Schouten en Zoon et al.; 1755; Tiles <a href='https://leiden.georeferencer.com/maps/8ddef876-2303-5d88-923a-c1c49e3a22c7/'>Universiteit Leiden</a>.",
	id:"8ddef876-2303-5d88-923a-c1c49e3a22c7"
	});
	
	// Google Hybrid Basemap
	var oldTilesCirebon = L.tileLayer('https://maps.georeferencer.com/georeferences/a0180fff-aa14-51b8-9ae8-1a7adf7eced3/2019-06-07T09:26:36.104379Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "reede Cheribon by Melvill van Carnbee; 1886; Tiles <a href='https://leiden.georeferencer.com/maps/9d27ee86-c300-5359-9855-b7e9bca1099e/'>Universiteit Leiden</a>.",
	id:"a0180fff-aa14-51b8-9ae8-1a7adf7eced3"
	});
	
	// Google Hybrid Basemap
	var oldTilesBatavia = L.tileLayer('https://maps.georeferencer.com/georeferences/4b43c2c9-fb46-52c2-9ea9-bc22e2781295/2019-06-19T12:08:40.956428Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "Kaart van Batavia en Omstreken by Topographisch Bureau Batavia; 1897; Tiles <a href='https://leiden.georeferencer.com/maps/ac7e7df1-6aea-5748-a315-c09fafd3ac17/'>Universiteit Leiden</a>.",
	id:"ac7e7df1-6aea-5748-a315-c09fafd3ac17"
	});
	
	// Google Hybrid Basemap
	var oldTilesSumatra = L.tileLayer('https://maps.georeferencer.com/georeferences/39ba733c-b255-5362-8a83-dd86a06fc89d/2019-11-08T16:25:46.431122Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "To Captain Samuel Ashmore, in acknowledgement of much valuable information given, ... inscribed by James Horsburgh; 1832; Tiles <a href='https://uu.georeferencer.com/maps/130243b8-5c89-5d56-b11e-2b516e146d10/'>Utrecht University</a>.",
	id:"130243b8-5c89-5d56-b11e-2b516e146d10"
	});
	
	// Google Hybrid Basemap
	var oldTilesSumatra2 = L.tileLayer('https://maps.georeferencer.com/georeferences/803e0e82-662b-57b8-955d-fee99be550ac/2020-06-12T23:04:01.957038Z/map/{z}/{x}/{y}.png?key=sPjsmpzUociMSuMg5BlY',{
    maxZoom: 20,
	attribution: "Carte du Royaume de Siam et des pays Circunvoisins by Du Val, Pierre, 1619-1683; 1686; Tiles <a href='https://davidrumsey.georeferencer.com/maps/5be79ad9-9aff-5a4a-9c35-ac67b75859eb/'>davidrumsey.com</a>.",
	id:"5be79ad9-9aff-5a4a-9c35-ac67b75859eb"
	});
	
	// Variabel map
	var map = L.map('map', {
		center: [params.lat || -6.269577,
				 params.lng || 106.705615],
		zoom: params.zoom || 11,
		layers: [basemap_default],
		zoomControl: false
	});	
	
	//Scale bar
	new L.control.scale({ metric: true, imperial:false,  position: 'bottomright' 
	}).addTo(map);
	// Zoom controller
	new L.Control.Zoom({ position: 'bottomright' }).addTo(map);
	// Share Button
	L.easyButton({
	  id: 'id-for-the-button',  // an id for the generated button
	  position: 'bottomright',      // inherited from L.Control -- the corner it goes in
	  type: 'replace',          // set to animate when you're comfy with css
	  leafletClasses: true,     // use leaflet classes to style the button?
	  states:[{                 // specify different icons and responses for your button
		stateName: 'get-sharelink',
		onClick: function(button, map){
			//let copyText = window.location.href;
			let copyText = document.createElement('textarea');
			copyText.value = window.location.href;
			document.body.appendChild(copyText);
			/* Select the text field */
			copyText.select();
			copyText.setSelectionRange(0, 99999); /*For mobile devices*/
			document.execCommand("copy");
			document.body.removeChild(copyText);
			alert('Link copied to clipboard');
		},
		title: 'Share',
		icon: 'fa-share-alt'
	  }]
	}).addTo(map);
	
	// leaflet-color-markers by pointhi
	var redIcon = new L.Icon({
	  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
	  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
	  iconSize: [25, 41],
	  iconAnchor: [12, 41],
	  popupAnchor: [1, -34],
	  shadowSize: [41, 41]
	});	
	
	//Other Ver
	//var oldWMTS = L.tileLayer.wms('https://maps.georeferencer.com/georeferences/69c451b6-0b1a-5315-9e17-88930d099731/2020-04-07T17:48:47.586709Z/wmts?key=sPjsmpzUociMSuMg5BlY&SERVICE=WMTS&REQUEST=GetCapabilities', {
	//	layers: 'TOPO-WMS,OSM-Overlay-WMS'
	//}).addTo(map);
	
	//Variabel untuk Layer Controller
	var baseMaps = {
		"OSM": osmLayer,
		"Streetview": googleStreets,
		"Satellite": googleSat,
		"Hybrid": googleHybrid
	};
	var overlayArray = [
			// World
		oldTilesAtlas2,
		oldTilesAtlas3,
		oldTilesAtlas4,
			// Indonesia - Asia
		oldTilesIndonesia2,
		oldTilesIndonesia,
		oldTiles2,
		oldTiles,
		oldTilesJava2,
		oldTiles3,
		oldTilesIndonesia3,
		oldTilesJava,
		oldTiles4,
		oldTilesAsia4,
		oldTilesAsia,
		//oldTilesAtlas,
		oldTilesAsia3,
		oldTilesAsia5,
		oldTilesAsia2,
			// Other
		oldTilesCirebon,
		oldTilesBatavia,
		oldTilesSumatra,
		oldTilesSumatra2,
		
	]
	var overlayThemes = [[0,"World Maps"],
						 [3,"Indonesia - Asia Maps"],
						 [17,"Other Maps"],]
	
	// adding id to overlay and other infos
	var i = 0;
	var overlayMaps = {};
	
	overlayArray.forEach(function(overlay){
		//for array
		let attr = overlay.options.attribution.split(';');
		overlay.id = overlay.options.id;
		overlay.title = attr[0];
		overlay.year = attr[1].replace(' ','');
		//for dict
		overlayMaps[overlay.id] = overlay
		i++;
	});
	
	// side by side
	var compareControl = L.control.sideBySide(basemap_default, basemap_default);
	
	// Use the custom grouped layer control, not "L.control.layers"
	//var layerControl= L.control.layers(baseMaps, overlayMaps).addTo(map);

	map.on('moveend', updateURL);
	map.on('zoomend', updateURL);
	map.on('baselayerchange', updateURL);
	map.on('overlayadd', updateURL);
	map.on('overlayremove', updateURL);
	
	function layerSwitch(key){
		let layer = overlayMaps[key];
		let elm = "Op"+key
		if (map.hasLayer(layer)){
			layer.remove();
			document.getElementById(elm).disabled = true; 
		} else {
			layer.addTo(map);
			document.getElementById(elm).disabled = false;
			//console.log("harusnya nyala "+ elm);
		}
		updateURL();
	}
	
	function baseSwitch(key){
		let layer = baseMaps[key];
		basemap_default = layer
		//let elm = "BM_"+key
		layer.addTo(map);
		layer.bringToBack();
		Object.keys(baseMaps).forEach(function(keyz) {
			if (map.hasLayer(baseMaps[keyz]) && layer != baseMaps[keyz]){baseMaps[keyz].remove();};
		});
		//document.getElementById(elm).disabled = false;
			//console.log("harusnya nyala "+ elm);
		updateURL();
	}
	
	function layerOpSlider(value,key){
		let layer = overlayMaps[key];
		let elm = "Op"+key
		layer.setOpacity(value/100);
	}
	
	// Responsive resize window
	function resizeWindow(){
		document.querySelector('.bottom-drawer').style.top = window.innerHeight - btmDrawerHeight + 'px'
		if(infoBox){$(infoBox).html('')};
		mobileCheck = (window.innerWidth < window.innerHeight);
		infoBox = mobileCheck ? '.drawer-content' : '.sidenav-content';
		otherInfoBox = mobileCheck ? '.sidenav-sec' : '.bottom-drawer';
		anotherInfoBox = !mobileCheck ? '.sidenav-sec' : '.bottom-drawer';
		//console.log("mobile check: "+mobileCheck);
		//$(anotherInfoBox).css({opacity: '100'})
		//$(otherInfoBox).css({opacity: '0'})
		let lebar_tab = "20%";
		let tab = '<div class="tab">'+
				  '<button class="tablinks" title="layers" onclick="openTab(event,'+"'layers'"+')" style="width:'+lebar_tab+'"><i class="fa fa-layer-group" aria-hidden="true"></i></button>'+
				  '<button class="tablinks" title="story" onclick="openTab(event,'+"'story'"+')" style="width:'+lebar_tab+'"><i class="fas fa-book" aria-hidden="true"></i></button>'+
				  '<button class="tablinks" title="compare" onclick="openTab(event,'+"'compare'"+')" style="width:'+lebar_tab+'"><i class="fa fa-arrows-alt-h" aria-hidden="true"></i></button>'+
				  '<button class="tablinks" title="share" onclick="openTab(event,'+"'share'"+')" style="width:'+lebar_tab+'"><i class="fa fa-share-alt" aria-hidden="true"></i></button>'+
				  '<button class="tablinks" title="about" onclick="openTab(event,'+"'about'"+')" style="width:'+lebar_tab+'"><i class="fa fa-info-circle" aria-hidden="true"></i></button>'+
				'</div>'+
				'<div id="layers" class="tabcontent">';
		let endtab = '</div><div id="compare" class="tabcontent"></div>'+
							'<div id="story" class="tabcontent"></div>'+
							'<div id="share" class="tabcontent"></div>'+
							'<div id="about" class="tabcontent"></div>';
		
		if(mobileCheck){
			$('.bottom-drawer').css("z-index","9999");
			$('.sidenav-sec').css("z-index","0");
			$('.leaflet-control').css("bottom",btmDrawerHeight + 5);
			$('.bottom-drawer').html('<div class="nav-drawer">'+
										'<div class="text-center" id="bottom-sheet" style="padding: 10px">'+
											'<div style="width:100px;height:4px;background-color: #BDBDBD;margin: auto;border-radius: 50px"></div>'+
										'</div>'+tab+
										'<div class="drawer-content" id="drawer-content">'+
										'</div>'+endtab+
									'</div>');
			$('.sidenav-sec').html();
		} else {
			$('.bottom-drawer').css("z-index","0");
			$('.sidenav-sec').css("z-index","9999");
			$('.sidenav-sec').html('<div id="mySidenav" class="sidenav">'+tab+
										'<div class="sidenav-content" style="padding-left: 5%;padding-right: 5%;overflow: auto;"></div>'+endtab+
										'<div id="btnSidenav" class="btnSidenav" onclick="btnNav()"><i id="btnIcon" style="font-size:14px;"class="fas fa-caret-right"></i>'+
									'</div>');
			$('.bottom-drawer').html()
		}
		updateURL;
		embed = createEmbed();
		let sharecontent = '\
		<div style="font-size: 14px;overflow-y:auto;border:solid;border-width: 1px;background-color: #f4f4f4;border-color: #dcdcdc;"><b>Share a link to this map</b><button id="copyURL" class="copybtn" title="Copy this link" onClick="copyText('+"'urlshare'"+')" style="background-color: #f4f4f4;border-color: #dcdcdc;font-size: 14px;border:none;border-width: 1px;float: right;">Copy link</button></div>\
		<textarea id="urlshare" name="urlshare" rows="4" style="resize: none;width:100%;box-sizing:border-box" readonly>'+window.location.href+'</textarea><br>\
		<div style="float: right">\
			<button id="btnShareEMAIL" class="button sharebtn" data-sharer="email" title="E-mail" data-title="Checkout this amazing historic maps!" data-url="'+window.location.href+'" style="background-color: #dd4b39;color:white;" data-subject="Hey! Check this out" data-to=""><i class="far fa-envelope"></i></button>\
			\
			<button id="btnShareFB" class="button sharebtn" data-sharer="facebook" title="Facebook" data-hashtag="amazingmap" data-url="'+window.location.href+'" style="background-color: #3B5998;color:white;"><i class="fab fa-facebook-f"></i></button>\
			\
			<button id="btnShareTwitter"  class="button sharebtn" data-sharer="twitter" title="Twitter" data-title="Checkout this amazing historic maps!" data-url="'+window.location.href+'" style="background-color: #55ACEE;color:white;" data-hashtags="amazinmap, irhaMap, historicalmaps, vintage"><i class="fab fa-twitter"></i></button>\
			\
			<button id="btnShareWA" class="button sharebtn" data-sharer="whatsapp" title="Whatsapp." data-web data-title="Checkout this amazing historic maps!" data-url="'+window.location.href+'" style="background-color: #4DC247;color:white;"><i class="fab fa-whatsapp"></i></button>\
		</div>\
		<br><br><br>\
		<div style="font-size: 14px;overflow-y:auto;border:solid;border-width: 1px;background-color: #f4f4f4;border-color: #dcdcdc;"><b>Embeded this map in a website</b><button id="copyURL" class="copybtn" title="Copy this link" style="background-color: #f4f4f4;border-color: #dcdcdc;font-size: 14px;border:none;border-width: 1px;float: right;" onClick="copyText('+"'embshare'"+')">Copy link</button></div>\
		<textarea id="embshare" name="embshare" rows="6" style="resize: none;width:100%;box-sizing:border-box" readonly>'+embed+'</textarea>\
		<select name="embSize" id="embSize" onchange="changeSizeEmbed()">\
			<option value="sm">Small</option>\
			<option value="md">Medium</option>\
			<option value="la">Large</option>\
			<option value="cu">Custom</option>\
		</select>\
		<input type="number" id="embWidth" name="embWidth" value="300" style="width:50px;" onchange="changeSizeEmbedNum()"> x <input type="number" id="embHeight" name="embHeight" value="200" style="width:50px;" onchange="changeSizeEmbedNum()">'
		$('#share').html(sharecontent)
		
		let aboutcontent = '\
		<div style="overflow-y:auto;height:auto">\
		<h4>About This Website</h4>\
		<p></p>\
		<h4>Untuk Yang Tertarik Dengan Bagaimana Website Ini Terbentuk</h4>\
		\
		Berbagai macam tools/teknologi digunakan untuk menciptakan peta ini, diantaranya:\
		<p style="text-align: justify">\
		Halaman web dibuat dengan menggunakan HTML dan Javascript. Halaman tersebut diupload dan dihosting pada penyedia layanan hos web bersama untuk proyek pengembangan perangkat lunak yang menggunakan sistem kendali versi <i>Git</i> dan layanan hosting internet <a href="https://github.com">Github</a>.<br><br>\
		\
		Peta ditampilkan dengan menggunakan library <a href="https://leafletjs.com">Leaflet.js</a>. Peta ini dikustomisasi dengan menggunakan javascript dan beberapa plugin.\
		Data peta yang digunakan dikumpilkan dari beberapa sumber diantaranya '+
		"<a href='https://www.davidrumsey.com/'> David Rumsey Map Collection</a>, <a href='https://digitalcollections.nypl.org/'>The New York Public Library</a>, <a href='https://collections.leventhalmap.org/'>Norman B. Leventhal Map & Education Center at the Boston Public Library</a>, <a href='https://digitalcollections.universiteitleiden.nl/'>Universiteit Leiden</a>, <a href='https://www.uu.nl/en'>Utrecht University Library</a>, <a href='http://staremapy.cz'>staremapy.cz</a> dan mesin pencari <a href='https://www.oldmapsonline.org'>Old Maps Online</a>."+
		" Peta tergeoreferensi atau tergeorektifikasi secara online dengan menggunakan <a href='https://www.georeferencer.com'>Georeferencer</a>. Tiles yang digunakan pada peeta ini juga dihasilkan pada <a href='https://www.georeferencer.com'>Georeferencer</a>.<\p><\div>"
		$('#about').html(aboutcontent);
		
		let storycontent = '<div id="storyContent" style="overflow-y:auto;height:auto"><\div>'
		$('#story').html(storycontent);
		
		// Compare are created on layer creation
	}
	resizeWindow();
	createLayerbox();
	//window.addEventListener('resize',resizeWindow);
	
	// Create embed text
	function createEmbed(){
		let url = window.location.href
		url = url.replace("&tab=share","");
		return '<iframe width="'+embedWidth+'" height="'+embedHeight+'" frameborder="0" scrolling="no" allowfullscreen src="'+url+'"></iframe>'
	}
	// change embed size by input number
	function changeSizeEmbedNum(){
		embedWidth = document.getElementById("embWidth").value
		embedHeight = document.getElementById("embHeight").value
		document.getElementById("embshare").value = createEmbed();
		document.getElementById("embSize").value = "cu";
	}
	// change embed size by select tag
	function changeSizeEmbed(){
		let val = document.getElementById("embSize").value;
		if(val=="sm"){
			embedWidth = 300;embedHeight = 200;
		} else if (val=="md") {
			embedWidth = 800;embedHeight = 600;
		} else if (val=="la") {
			embedWidth = 1080;embedHeight = 720;
		}
		//console.log(val)
		document.getElementById("embshare").value = createEmbed();
		document.getElementById("embWidth").value = embedWidth;
		document.getElementById("embHeight").value = embedHeight;
	}
	
	// change compared layer
	function changeCompare(pos="r"){
		// console.log(pos);
		let lval = document.getElementById("leftCompare").value;
		let rval = document.getElementById("rightCompare").value;
		// console.log("lval")
		// console.log(lval)
		// console.log("rval")
		// console.log(rval)
		if(lval==rval && rval != "None"){
			if(pos=="l"){rval = "None";
			} else {lval = "None";};
		}
		let valforL , valforR;
		if (rval=="None"){ 
			compareControl.setRightLayers(basemap_default); 
			document.getElementById("rightCompare").value = rval
		} else {
			// console.log("rval " + rval)
			compareControl.setRightLayers(getLayerFromID(rval));
		};
		if (lval=="None"){ 
			compareControl.setLeftLayers(basemap_default); document.getElementById("leftCompare").value=lval
		} else {
			compareControl.setLeftLayers(getLayerFromID(lval));
			
		};		
		//if(lval==rval && rval == "None"){
		//	compareControl.remove();
		//	compareControl.addTo(map);
		//}
	}

	function getLayerFromID(id){
		// console.log("get layer from id")
		// console.log(id)
		let map = null
		overlayArray.forEach(function(overlay){
			if (overlay.id == id) { map = overlay}
		})
		// console.log(map.id)
		return map
	}
	
	// Writing layerbox
	function createLayerbox(){
		$(infoBox).html('<div id="layerbox"></div>')
		var divLB = document.querySelector('#layerbox');
		let html = '';
		
		// Basemap
		//html+='<div style="padding-bottom: 10px;padding-left:10px ;font-size:14px;text-align: justify;">Basemaps<br>'
		html+='<ul id="ulLayer"><li><span class="caret">Basemaps ('+Object.keys(baseMaps).length+')</span><ul class="nested">'
		Object.keys(baseMaps).forEach(function(key) {
			let haslayer = ""
			if (map.hasLayer(baseMaps[key])){haslayer = "checked";}
			html+='<input type="radio" id="BM_'+key+'" name="basemapRadio" value="'+key+'" onclick='+"baseSwitch('"+key+"') "+haslayer+' /> <label for="BM_'+key+'">'+key+'</label><br>'
		});
		html+='</ul></li></ul>'
		//html+='</div>'
		
		//Compare data creation
		let comparecontentL = '<select name="leftCompare" id="leftCompare" onchange="changeCompare('+"'l'"+')" style="width:100%"><option value="None">None</option>'
		let comparecontentR = '<select name="rightCompare" id="rightCompare" onchange="changeCompare()" style="width:100%"><option value="None">None</option>'
		
		// Layers
		let i = 0; let j=0;
		let maxindex = 0
		let maxlayer = Object.keys(overlayMaps).length
		html+='<ul id="ulLayer"><li><span class="caret">Layers ('+maxlayer+')</span><ul class="nested">'
		overlayArray.forEach(function(overlay){
			if (i==overlayThemes[j][0]){
				let sum = (j==2)?  maxlayer-overlayThemes[j][0] : overlayThemes[j+1][0]-overlayThemes[j][0]
				html+='<ul id="ulLayerTheme"><li><span class="caret">'+overlayThemes[j][1]+" ("+sum+")"+'</span><ul class="nested">'
				// option label
				//comparecontentR += '<optgroup label="'+overlayThemes[j][1]+'">'
				//comparecontentL += '<optgroup label="'+overlayThemes[j][1]+'">'
			}
			//console.log("i:"+i+" j:"+j);
			let nama = overlay.year+" | " + overlay.title
			let layer = overlayMaps[overlay.id];
			//console.log(overlay.id+" "+haslayer)
			let maxChar = mobileCheck ? 45 : 35
			if (nama.length>maxChar){ nama = nama.slice(0, maxChar-3) + "...";}
			html +='<li><span class="caret" style="font-size:12px;text-align: justify;" title="'+overlay.title+" ("+overlay.year+")"+'"><input type="checkbox" id="Ch_'+overlay.id+'" onclick='+"layerSwitch('"+overlay.id+"')"+'>'+nama+'</span><ul class="nested"><li style="font-size:12px; display:flex; flex-direction:row; align-items:center;width:75%;">Opacity : 0<input type="range" style="flex:1;" id="Op'+overlay.id+'" oninput="'+"layerOpSlider(this.value,'"+overlay.id+"')"+'" min="0" max="100" value="100" disabled>100</li></ul></li>'
			// add layer to option if added to map
			if(map.hasLayer(layer)){
			comparecontentL += '<option value="'+overlay.id+'">'+nama+'</option>'
			comparecontentR += '<option value="'+overlay.id+'">'+nama+'</option>'
			}
			maxindex = (j==2)? maxlayer : overlayThemes[j+1][0]-1
			if (i==maxindex){
				html+='</ul></li></ul>'
				//console.log("i:"+i+" j:"+j+"End");
				// Option label
				//comparecontentL += '</optgroup>'
				//comparecontentR += '</optgroup>'
				
				j++;
			}
			i++;
		});
		html+='</ul></li></ul>'
		divLB.innerHTML+=html;
		
		//end of compare select creation
		comparecontentL += '</select>'
		comparecontentR += '</select>'
		let comparecontent = '<div style="overflow-y:auto;height:100%">\
		<div style="font-size: 14px;overflow-y:auto;"><b>Left Layer</b></div>\
		'+comparecontentL+
		'<br><br><div style="font-size: 14px;overflow-y:auto;"><b>Right Layer</b></div>\
		'+comparecontentR+
		'<\div>'
		$('#compare').html(comparecontent);
		
	}
	
	// Re-write opt layer for compare
	function reWriteOptLayer(){
		//Compare data creation
		let comparecontent = '<option value="None">None</option>'
		overlayArray.forEach(function(overlay){
			let layer = overlayMaps[overlay.id];
			let nama = overlay.year+" | " + overlay.title
			let maxChar = mobileCheck ? 45 : 35
			if (nama.length>maxChar){ nama = nama.slice(0, maxChar-3) + "...";}
			// add layer to option if added to map
			if(map.hasLayer(layer)){
				comparecontent += '<option value="'+overlay.id+'">'+nama+'</option>'
			}
		});
		console.log(comparecontent)
		document.getElementById("leftCompare").innerHTML= comparecontent;
		document.getElementById("rightCompare").innerHTML=comparecontent;
	};
	
	function copyText(id){
		let copyText = document.getElementById(id);
		copyText.select();
		copyText.setSelectionRange(0, 99999); /*For mobile devices*/
		document.execCommand("copy");
		alert('Link copied to clipboard');
	}
	
	// Toogle Tree View
	var toggler = document.getElementsByClassName("caret");
	var i;

	for (i = 0; i < toggler.length; i++) {
	  toggler[i].addEventListener("click", function(evt) {
		// cek kalo checkbox yang di klik ga aktif tree viewnya
		if(evt.target.tagName!="INPUT"){
			this.parentElement.querySelector(".nested").classList.toggle("active");
			this.classList.toggle("caret-down");
		}
	  });
	}
	
	// Create Story
	function createStoryContent(){
		let content = '';
		let story, img;
		overlayArray.forEach(function(overlay){
			story = overlay.options.story;
			if (map.hasLayer(overlay) && story){
				//console.log();
				img = overlay.options.img;
				content += '<h4 style="text-align: center">'+overlay.title+'</h4><p style="text-align: justify;font-size:14px;">'+story+'<br><br><a target="_blank" href="'+img+'">[Lihat peta sebenarnya]</a></p><hr>'
			}
		});
		document.getElementById("storyContent").innerHTML = content;
	}
	
	// Function for tab content
	function openTab(evt, itemData) {
	  var i, tabcontent, tablinks;
	  tabcontent = document.getElementsByClassName("tabcontent");
	  for (i = 0; i < tabcontent.length; i++) {
		tabcontent[i].style.display = "none";
	  }
	  tablinks = document.getElementsByClassName("tablinks");
	  for (i = 0; i < tablinks.length; i++) {
		tablinks[i].className = tablinks[i].className.replace(" active", "");
	  }
	  document.getElementById(itemData).style.display = "block";
	  evt.currentTarget.className += " active";
	  if(evt.currentTarget.title=="story"){createStoryContent();}
	  if(evt.currentTarget.title=="compare"){
		reWriteOptLayer();
		compareControl.addTo(map);
		compareControl.setLeftLayers(osmLayer);
		compareControl.setRightLayers(osmLayer);
	  } else {
		compareControl.remove();
	  }
	  updateURL();
	}

	
	/*//=====================================================================================
	READ ALL PARAM FROM URL
	*///=====================================================================================

	if (params.basemap){
		osmLayer.remove()
		baseMaps[params.basemap].addTo(map);
	}
	
	if (params.layers){
		var activeLayers = params.layers.split(';').map(function(item){
			// map function not supported in IE < 9
			//console.log(item);
			overlayMaps[decodeURIComponent(item)].addTo(map)
			//console.log("Ch_"+decodeURIComponent(item)	)
			document.getElementById("Ch_"+decodeURIComponent(item)).checked = true;
			document.getElementById("Op"+decodeURIComponent(item)).disabled = false;
		})
	}
	
	if (params.tab){
		document.getElementById(params.tab).style.display = "block";
		let tablinks = document.getElementsByClassName("tablinks");
		for (i = 0; i < tablinks.length; i++) {
			if(tablinks[i].title == params.tab){
				tablinks[i].className += " active";
				if(mobileCheck){ botDrawerByPos(2); // mid up drawer
				}else{btnNav();};
			};
		}
		if (params.tab=="compare"){
			reWriteOptLayer();
			compareControl.addTo(map);
		}
	}else{
		document.getElementById("layers").style.display = "block";
		document.getElementsByClassName("tablinks")[0].className += " active";
	}
	
	
	// Marked Point
	if (params.marked_content){
		var marked = L.marker([params.marked_lat || params.lat || map.getCenter().lat,
				       params.marked_lng || params.lng || map.getCenter().lng],
				       {icon: redIcon}).addTo(map);
		marked.bindPopup(decodeURIComponent(params.marked_content)).openPopup();
	};
		
	// Change URL after load
	updateURL();
	
	// Create Story content after load
	createStoryContent();
	
	// give param to URL when panning
	function updateURL(e) {
		//console.log(map.zoom.animate);
		text="?@"+map.getCenter().lat+","+map.getCenter().lng+","+map.getZoom()+"z"
		if (marked){
			text+="&marked="+encodeURIComponent(marked.getPopup().getContent());
			if (marked.getLatLng() != map.getCenter()){
				text+="@"+marked.getLatLng().lat+","+marked.getLatLng().lng
			}
		}
		if (!map.hasLayer(basemap_default)){
			Object.keys(baseMaps).forEach(function(key) {
				if (map.hasLayer(baseMaps[key])){
					//console.log(key, baseMaps[key]);
					text+="&basemap="+key
				}
			});
		}
		let i=0;
		overlayArray.forEach(function(overlay){
			
			if (map.hasLayer(overlay)){
				if (i==0){
					text+="&layers="+overlay.id				
				} else {
					text+=";"+overlay.id
				}
				i++;
			}
		});
		
		// only if sidebar/down-drawer open
		let tabcontent = document.getElementsByClassName("tabcontent");
		for (i = 0; i < tabcontent.length; i++) {
			if(tabcontent[i].style.display == "block" && 
			    ( (!mobileCheck && document.getElementById("btnSidenav").style.left == "25%") ||
				document.querySelector('.bottom-drawer').style.top < window.innerHeight * 80 /100 + 'px'  )){
			   text += "&tab="+tabcontent[i].id;
			};
		}
		
		// Update urlbox
		history.replaceState(null,null,text);
		//update share textbox
		if ($("#urlshare")){
			let url = window.location.href.replace("&tab=share","");
			document.getElementById("urlshare").value= url;
			if (document.getElementById("btnShareEMAIL")){document.getElementById("btnShareEMAIL").dataset.url= url;};
			if (document.getElementById("btnShareFB")){document.getElementById("btnShareFB").dataset.url= url;};
			if (document.getElementById("btnShareTwitter")){document.getElementById("btnShareTwitter").dataset.url= url;};
			if (document.getElementById("btnShareWA")){document.getElementById("btnShareWA").dataset.url= url;};
			if (document.getElementById("embshare")){document.getElementById("embshare").value = createEmbed();}
		}
	}
</script>



</body>
</html>
