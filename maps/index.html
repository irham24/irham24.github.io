<!DOCTYPE html>
<html>
<head>
	
	<title>IrhaMap</title>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<!-- Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.3/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.3/dist/leaflet.js" integrity="sha512-tAGcCfR4Sc5ZP5ZoVz0quoZDYX5aCtEm/eu1KhSLj2c9eFrylXZknQYmxUssFaVJKvvc0dJQixhGjG2yXWiV9Q==" crossorigin=""></script>
	<style>
		html, body {
			height: 100%;
			width: 100%;
			margin: 0;
		}
		#map {
			height: 100vh;
	  	width: 100%;
		}
	</style>
	
</head>
<body>

<div id='map'></div>

<script>
	// get Param from URLs
	var params = {};
	var i = 0;
	window.location.href.replace(/[?@&]+([^&]*)/gi, function(m, item){
		//params[key] = value;
		if (i==0){
			let item_arr = item.split(",");
			params['lat'] = item_arr[0];
			params['lng'] = item_arr[1];
			params['zoom'] = item_arr[2].replace("z", "");
			//console.log(item_arr);
		} else {
			item_arr = item.split("=");
			if (item_arr[0]=="marked"){
				let value = item_arr[1].split("@");
				params['marked_content'] = value[0];
				if (value.length > 1){
					let coord = value[1].split(",");
					params['marked_lat'] = coord[0];
					params['marked_lng'] = coord[1];
				} else {
					params['marked_lat'] = params['lat'];
					params['marked_lng'] = params['lng'];
				}
			} else {
				params[item_arr[0]] = item_arr[1];
			}
		}
		i+=1;
	});
	//console.log(params);


	// Basemap map
	
	// Esri Basemap
	//L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer/tile/{z}/{y}/{x}', {
	//	attribution: 'Tiles &copy; Esri &mdash; Source: Esri, DeLorme, NAVTEQ, USGS, Intermap, iPC, NRCAN, Esri Japan, METI, Esri China (Hong Kong), Esri (Thailand), TomTom, 2012'
	//}).addTo(map);
	
	// Google Streets Basemap
	var googleStreets = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}',{
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3'],
	attribution: 'Tiles &copy; Google'
	});
	// Google Satelite Basemap
	var googleSat = L.tileLayer('http://{s}.google.com/vt/lyrs=s&x={x}&y={y}&z={z}',{
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3'],
	attribution: 'Tiles &copy; Google'
	});
	// Google Hybrid Basemap
	var googleHybrid = L.tileLayer('http://{s}.google.com/vt/lyrs=s,h&x={x}&y={y}&z={z}',{
    maxZoom: 20,
    subdomains:['mt0','mt1','mt2','mt3'],
	attribution: 'Tiles &copy; Google'
	});
	
	// Variabel map
	var map = L.map('map', {
		center: [params.lat || -6.269577,
				 params.lng || 106.705615],
		zoom: params.zoom || 11,
		layers: [googleStreets]
	});
	
	// Marker Mess
	var marker = L.marker([-6.269577, 106.705615]).addTo(map);
	marker.bindPopup("Point");//.openPopup();
	
	// leaflet-color-markers by pointhi
	var redIcon = new L.Icon({
	  iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',
	  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',
	  iconSize: [25, 41],
	  iconAnchor: [12, 41],
	  popupAnchor: [1, -34],
	  shadowSize: [41, 41]
	});
	
	// Marked Point
	if (params.marked_content){
		var marked = L.marker([params.marked_lat || params.lat || map.getCenter().lat,
				       params.marked_lng || params.lng || map.getCenter().lng],
				       {icon: redIcon}).addTo(map);
		marked.bindPopup(decodeURIComponent(params.marked_content)).openPopup();
	};
	
	
	//Variabel untuk Layer Controller
	var baseMaps = {
		"Streetview": googleStreets,
		"Satellite": googleSat,
		"Hybrid": googleHybrid
	};
	
	var overlayMaps = {
		"Mess": marker
	};

  // Use the custom grouped layer control, not "L.control.layers"
	L.control.layers(baseMaps, overlayMaps).addTo(map);
	
	// Change URL after load
	updateURL();
	
	// give param to URL when panning
	function updateURL(e) {
		//console.log(map.zoom.animate);
		text="?@"+map.getCenter().lat+","+map.getCenter().lng+","+map.getZoom()+"z"
		if (marked){
			text+="&marked="+encodeURIComponent(marked.getPopup().getContent());
			if (marked.getLatLng() != map.getCenter()){
				text+="@"+marked.getLatLng().lat+","+marked.getLatLng().lng
			}
		}
		history.replaceState(null,null,text);
	}

	map.on('moveend', updateURL);
	map.on('zoomend', updateURL);
</script>



</body>
</html>
